<!DOCTYPE html>

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Live input record and playback</title>
  <style type='text/css'>
    ul { list-style: none; }
    #recordingslist audio { display: block; margin-bottom: 10px; }
  </style>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<body>

  <h1>Recorder.js simple WAV export example</h1>
  <p>Make sure you are using a recent version of Google Chrome, at the moment this only works with Google Chrome Canary.</p>
  <p>Also before you enable microphone input either plug in headphones or turn the volume down if you want to avoid ear splitting feedback!</p>

  <button id="btn1">開始廣播</button>

  <h2>Recordings</h2>
  <ul id="recordingslist"></ul>

  <h2>Log</h2>
  <pre id="log"></pre>

  <script>
    $("#btn1").click(function(){
      $.post('/api/broadcast/start', {
        type: 'ws',
        area: [],
        address: '192.168.0.1'
      }, function(data){
        if (data.message === 'OK') {
          const broadcast_socket = new WebSocket('ws://localhost:8000');
          broadcast_socket.binaryType = 'arraybuffer'
          broadcast_socket.onopen = function () {
          console.log(broadcast_socket);
          console.log('connect');
          setInterval(() => {
            broadcast_socket.send('打招呼')  // broadcast 使用者送資料
          }, 1000)
          };
        }
      });
    });

  </script>
  <script src="socket_io.js"></script>
</body>
</html>
